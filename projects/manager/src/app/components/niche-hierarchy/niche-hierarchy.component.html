<div class="backdrop hide" [ngClass]="{'show': show}" (transitionend)="onHide()"></div>

<div #base
     class="base translate-start"
     [ngClass]="{'translate-end': show}"
     (transitionend)="onHide()"
     (mouseenter)="overNicheHierarchy.next(true)"
     (mouseleave)="overNicheHierarchy.next(false)">
    
    <div class="bar">

        <!-- Search icon -->
        <button style="margin-left: 0;"
                class="icon-button"
                (click)="toggleSearch()">
            <i *ngIf="!searchMode" style="pointer-events: none;" class="fas fa-search"></i>
            <i *ngIf="searchMode" class="fa fa-list"></i>
        </button>

        <div class="icons">
            
            <!-- Delete icon -->
            <icon-button [icon]="'fas fa-trash-alt'"
                         [title]="deleteButtonTitle"
                         [isDisabled]="!searchMode ? hierarchyUpdate.deleteDisabled : searchListUpdate.deleteDisabled == null ? true : searchListUpdate.deleteDisabled"
                         (onOver)="hierarchy ? hierarchy.overButton = $event : multiColumnList.overButton = $event"
                         (onClick)="hierarchy ? hierarchy.delete() : multiColumnList.delete()">
            </icon-button>
            
            <!-- Edit icon -->
            <icon-button [icon]="'fas fa-pencil-alt'"
                         [title]="editButtonTitle"
                         [isDisabled]="!searchMode ? hierarchyUpdate.editDisabled : searchListUpdate.editDisabled == null ? true : searchListUpdate.editDisabled"
                         (onOver)="hierarchy ? hierarchy.overButton = $event : multiColumnList.overButton = $event"
                         (onClick)="hierarchy ? hierarchy.delete() : multiColumnList.delete()">
            </icon-button>

            <!-- Add icon -->
            <icon-button *ngIf="!searchMode"
                         [icon]="'fas fa-plus-circle'"
                         [title]="addButtonTitle"
                         [isDisabled]="hierarchyUpdate.addDisabled"
                         (onOver)="hierarchy.overButton = $event"
                         (onClick)="hierarchy.add(null!, isParent)">
            </icon-button>

            <!-- Collapse icon -->
            <icon-button *ngIf="!searchMode"
                         [icon]="'fas fa-minus-square'"
                         [title]="'Collapse'"
                         [isDisabled]="hierarchyUpdate.collapseDisabled"
                         (onOver)="hierarchy.overButton = $event"
                         (onClick)="hierarchy.collapse()">
            </icon-button>
        </div>
    </div>
    <div class="drop-shadow"></div>

    
    <!-- Hierarchy -->
    <ng-container *ngIf="!searchMode">
        <div class="overflow-container" [style.height.px]="base.clientHeight - 40">
            <hierarchy #hierarchy [sourceList]="nicheHierarchyService.niches" [options]="hierarchyOptions" (onListUpdate)="hierarchyUpdate = $event"></hierarchy>
        </div>
    </ng-container>

    <!-- Search -->
    <ng-container *ngIf="searchMode">
        <input id="searchInput" placeholder="Search" (input)="onSearchInputChange($event.target)">

        <!-- Column Headers -->
        <ng-container *ngIf="searchList.length > 0">
            <div class="column-name-container">
                <div class="column-name">Name</div>
                <div class="column-name">Type</div>
            </div>

            <div class="column-underline-container">
                <div class="column-underline"></div>
                <div class="column-underline"></div>
            </div>
        </ng-container>

        <!-- List -->
        <div class="overflow-container" [style.height.px]="base.clientHeight - 116">
            <multi-column-list #multiColumnList [sourceList]="searchList" [options]="searchListOptions" (onListUpdate)="searchListUpdate = $event"></multi-column-list>
        </div>
    </ng-container>
</div>